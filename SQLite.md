# Работа с SQLite

## О SQLite
- Один файл – одна БД.
- Легко распространять данные. Нужно только скопировать файл БД. Можно импортировать или экспортировать данные из\в файлы других форматов.
- Быстрая и легковесная СУБД.
- Самая простая клиентская программа < 4 Мб. Библиотеки для языков программирования имеют сопоставимый размер.
- Есть библиотеки для взаимодействия со всех популярными языками программирования для всех популярных ОС.
Минимальная реализация SQL (стандарт SQL92).

## Установка
**Windows**
Скачайте и установите клиентское приложение SQLite (sqlite-tools-win-x64) 
со страницы sqlite.org/download.html.

**Ubuntu**
Установка Sqlite3 в ОС Убунту: `sudo apt install sqlite3`

**Другие клиентские приложения**
SQLite Manager – дополнение для Firefox

## Задание.

0. Создавайте отчёт когда выполняете все этапы задания. Пишите пояснения для действий.
1. Откройте предоставленный файл базы данных. Это информация об открытых профилях ВК.
2. Запустите программу из командной строки прямо из папки с файлом:
`sqlite3`\
*Для открытия командной строки (power shell) нажмите Shift + ПКМ на свободном месте в окне проводника*
Запущенная клиентская программа sqlite тоже имеет интерфейс командной строки. 
`sqlite3> .open <filename>`
См. перечень часто используемых команд ниже.
3. Просмотрите список таблиц.
4. Выведите несколько записей из таблицы.
5. Подсчитайте количество записей, используйте агрегатную функцию.
6. Проверьте есть ли среди записей люди имя (first_name) и фамилия (last_name) которые совпадает с вашими. Проверьте фамилию отдельно.
7. Выведите 10 человек, у которых больше всего подписчиков (followers_count). Показывайте только фамилию, имя, пол (sex), дату рождения (bdate) и количество подписчиков.
8. Подсчитайте количество профилей где подписчиков больше 10.
9. Подсчитайте количество профилей каждого пола.
10. Выведите 10 самых популярных имён. Выведите 10 самых популярных имен для каждого года рождения. Дата рождения записана в поле bdate_dt.
>>>>>>> e8986cddda45453d9bedf089f53c59401d724486
11. Сколько профилей имеют подписки, связанные с ЕГЭ (has_ege_pubs - количество таких подписок)? Сколько профилей у которых 0, 1, 2 и т. д. подписок связанных с ЕГЭ?
12. Узнайте количество профилей для каждого года рождения 2000 до 2010.

В таблице могут быть ошибки в данных, например в полях last_name, sex может быть записана длинная строка с другими данными профиля. Используйте фильтр по полю sex (должно содержать значения 1 или 2), чтобы не рассматривать ошибочные записи: `where sex in (1,2)`

## Часто используемые команды sqlite

Это команды (Dot Commands) клиентского приложения SQLite
- `.help` — показать справку по командам;
- `.open <filename>` — открыть файл базы данных; если файла не существует, то он будет создан.
- `.quit` — выйти из программы;
- `.tables` — показать список таблиц открытой БД;
- `.schema <table_name>` — показать SQL команду, использованную для создания данной таблицы.
- Вывести результат запроса в файл. Сначала указывается имя файла, потом SQL запрос(ы).
```sql
# выводить все результаты в файл
sqlite> .output albums.txt
sqlite> SELECT title FROM albums;
# выключить вывод результатов запроса в файл
sqlite> .output
# вывести в файл только результат следующего запроса
sqlite> .once albums.txt
sqlite> SELECT title FROM albums;
```
- Выполнить SQL запрос из файла `.read commands.txt`
- `.mode <column|csv|html>` — задать режим отображения данных (в виде таблицы, разделять запятыми, в виде html таблицы соответственно). 
- Импортировать данные из CSV файла `filename` в таблицу <table_name>
```sql
.mode csv
.import <filename> <table_name>
```

Не все команды имеют обратную связь и выводят сообщения на экран. Если не появилось сообщения об ошибке, то команда выполнена успешно.

Отдельно сохранять уже открытую БД не нужно, она сохраняется автоматически после каждой операции, которая изменяет данные.

Показать к предыдущую введённую команду — <kbd>&uarr;</kbd>.

Прервать выполнение текущей операции — <kbd>Ctrl</kbd> + <kbd>C</kbd>.

Перемещаться по словам введённой команды — <kbd>Ctrl</kbd> + <kbd>&larr;</kbd>; <kbd>Ctrl</kbd> + <kbd>&rarr;</kbd>.

Удобнее всего записывать и редактировать команды в отдельном текстовом редакторе (например Sublime Text), а потом вставлять их (ПКМ в Windows) в консоль SQLite.


## См. также
- клиентское приложение для СУБД DBeaver
- [работа с SQLite в Python](python.md)
- Работа с СУБД в Java: https://github.com/ivtipm/BigDataLanguages/tree/main/Java/DataBase
