## Введение в MongoDB
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/MongoDB_Logo.svg/2560px-MongoDB_Logo.svg.png" height=100>


**MongoDB** - это документо-ориентированная система управления базами данных (СУБД) с открытым исходным кодом, которая предоставляет высокую производительность, высокую доступность и легкую масштабируемость. Она работает на основе концепции *коллекций* и *документов*, а не таблиц и строк, как в традиционных реляционных (SQL) базах данных.

- MongoDB разработана компанией MongoDB Inc. (ранее 10gen) и первоначально выпущена в 2009 году. 
- Название “MongoDB” происходит от слова “humongous”, что в переводе с английского означает “огромный”, что отражает главную цель MongoDB - управлять большими наборами данных.
- Одна из самых популярных NoSQL баз данных. 
- Используется многими крупными компаниями, включая Adobe, SAP, eBay, Google и многими другими.
- Активно развивается, часто появляются новые возможности.
- Работает на Windows, Linux, MacOS и других ОС.
- Есть драйверы для всех популярных языков программировния.
- Скачать: https://www.mongodb.com/try/download/community
- Последняя версия (апрель 2024) - 7.0.8


В MongoDB данные хранятся в виде *документов*, которые сгруппированы в *коллекции*. 
**Документы** представляют собой наборы пар ключ-значение и имеют гибкую схему. Это означает, что документы в одной и той же коллекции не обязательно должны иметь одинаковые поля, и типы данных этих полей могут отличаться.





**Функциональные особенности MongoDB**
* Документо-ориентированная: MongoDB хранит данные в формате BSON (подобно JSON), что позволяет хранить сложные структуры данных и делает MongoDB идеально подходящей для работы с большими данными и реальным временем.
* Гибкая схема данных: В отличие от реляционных баз данных, в MongoDB нет жесткой схемы, что позволяет легко изменять структуру данных.
* Горизонтальная масштабируемость: MongoDB может легко масштабироваться горизонтально, добавляя больше серверов вместо того, чтобы увеличивать мощность одного сервера.
    * Данные могут хранится в репликах на разных серверах. При выходе из строя основного сервера, его может заменить другая реплика.
    * Шардирование - сегментирование объектов БД, при котором разные объекты могут хранится на разных узлах (шардах).
* Высокая доступность: С помощью репликации и автоматического восстановления после сбоев MongoDB обеспечивает высокую доступность данных.
    * поддерживает индексы
* Поддерживает транзакции, ACID


## SQL и noSLQ
NoSQL (Not Only SQL) - это термин, используемый для описания баз данных, которые не следуют традиционной модели SQL. MongoDB - это пример NoSQL базы данных.


* Структура данных: 
    * SQL: данных данные хранятся в таблицах, состоящих из строк и столбцов. Их перечень и типы данных чётко определены заранее. 
    * NoSQL: данные хранятся в формате документов, они могут хранить более сложные структуры данных.
* Схема данных: 
    * SQL базы данных имеют жесткую схему. Структура данных должна быть определена заранее и остается постоянной. 
    * В MongoDB схема данных гибкая, можно легко легко изменять структуру данных.
* Масштабируемость: 
    * SQL базы данных обычно масштабируются вертикально путем увеличения мощности одного сервера, 
    * MongoDB может масштабироваться горизонтально путем добавления большего количества серверов.


Преимущества MongoDB
- Гибкость: MongoDB позволяет хранить сложные структуры данных и легко изменять схему данных.
- Масштабируемость: MongoDB легко масштабируется горизонтально, что делает ее идеальной для работы с большими объемами данных.
- Производительность: MongoDB обычно обеспечивает более высокую производительность при работе с большими объемами данных.
Недостатки MongoDB
- Запросы: SQL язык запросов более мощный и гибкий, чем язык запросов MongoDB.
- Нормализация данных: MongoDB не поддерживает нормализацию данных, что может привести к избыточности данных.


## Устанвока и настройка
- СУБД mongodb
- mongo shell - консольный клиент для СУБД
- Легковсенаый веб-сервер для управления СУБД - mongo-express
- [MongoDB Compass](https://www.mongodb.com/docs/compass/current/install/) - клиентское приложение, имет встроенный mongo shell.

Скачать: https://www.mongodb.com/try/download/community

Консольный клиент mongo shell (`mongosh`): https://www.mongodb.com/try/download/shell\
Отсутствует в репозитории пакетов Ubuntu.

### Docker

```bash
docker pull
```
Образ занимает примерно 800 Мб.


Конфигурация docker compose:
```yml
version: '3.8'

services:

  # СУБД  
  mongo:
    image: mongo
    restart: always
    ports:    # порт основной ОС : порт контейнера
      - 27117:27017
    volumes:  # для сохранения данных
      - ./mongodb_data:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: password
  
  # веб-интерфейс для управления СУБД (написан на NodeJS)
  mongo-express:
    image: mongo-express
    restart: always
    # сервер будет доступе на порту 8081: в контейнере будет запущен на порту 8081
    ports:
      - 8081:8081
    environment:
      # логин и пароль для административной панель mongo-exoress
      ME_CONFIG_BASICAUTH_USERNAME: root1
      ME_CONFIG_BASICAUTH_PASSWORD: password1
      # логин и пароль для СУБД
      ME_CONFIG_MONGODB_ADMINUSERNAME: root
      ME_CONFIG_MONGODB_ADMINPASSWORD: password
      # строка конфигурации подключения веб-интерфейса к СУБД
      ME_CONFIG_MONGODB_URL: mongodb://root:password@mongo:27017/
      # mongodb - протокол
      # root:password - логин и пароль
      # @mongo:27017 - имя хоста и порт

```

Запуск (из папаки с compose файлом)
```bash
docker compose up
```

См. также основной файл конфигурациия mongodb: `/etc/mongod.conf`.

## Основные понятия и объекты


- `db` - *текущая* (выбранная) база данных. Назначить БД текущей: `use <db_name>`;
- `db.system` - системная информация, хранит системные коллекции.
  - `db.system.users` - данные и пава пользователей
## Подключение

Консоль (mongo shell), подключиться к локальному серверу (серверу на порту 27017):
```bash
mongosh -u username
```

Если не указывать имя пользователя, то запустится тестовая оболочка mongo shell.


Подключение к удалённому серверу:
```bash
mongosh -u username "mongodb://yourMongoDBUrl"
```


**список пользователй**
```
db.system.users.find()
```

# Работа с БД, создание коллекций, документов

просмотреть список БД
```
show dbs;
```

В только что установленном сервере существуют только служебные БД:
```
admin   100.00 KiB
config   60.00 KiB
local    72.00 KiB
```
- `admin` хранит информацию связанныю с администрированием, в частности содержит инофрмацию о пользователях и ролях.
- `config` хранит метаданные и конфигурационную информация для шардированных кластеров.
- `local` хранит данные, специфичные для каждого узла, и не реплицируется между узлами. Она содержит коллекции, которые используются в процессе репликации, и другие данные, специфичные для каждого экземпляра mongod. Например, local.startup_log содержит диагностическую информацию о самом экземпляре mongod и информацию о хосте.

Посмотреть список БД и решить другие административные задачи и CRUD задачи можно через административную панель mongo-express сервера, если он запущен. По умолчанию он работает на порту 8080.

Задать текущую БД:
```java
use <db_name>;
```
Если БД не существует, то ошибка не будет выведена.


Список пользователей:
```js
use admin
// переключится на БД admin
show users;
```

Cписок коллекций в текущей БД
```js
show collections
```


Список документов в коллекции `collection_name`
```js
db.collection_name.find();
```
Если коллекция не существует, то не будет выведено сообщения об ошибке.


# Интеграция с языками программирования
`pymongo` - пакет для Python